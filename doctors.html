<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Find Doctors | HealthCare+</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/themes.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-brand">
                <i class="fas fa-heartbeat"></i>
                <span>HealthCare+</span>
            </div>
            <div class="nav-menu">
                <a href="index.html" class="nav-link">Home</a>
                <a href="doctors.html" class="nav-link active">Doctors</a>
                <a href="booking.html" class="nav-link">Book Appointment</a>
                <a href="login.html" class="nav-link">Login</a>
                <button id="theme-toggle" class="theme-toggle" aria-label="Toggle theme">
                    <i class="fas fa-moon"></i>
                </button>
            </div>
            <div class="nav-toggle">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </div>
    </nav>

    <!-- Page Header -->
    <section class="page-header">
        <div class="container">
            <h1>Find Your Doctor</h1>
            <p>Browse through our network of qualified healthcare professionals</p>
        </div>
    </section>

    <!-- Search and Filter Section -->
    <section class="search-section">
        <div class="container">
            <div class="search-container">
                <div class="search-bar">
                    <div class="search-input-group">
                        <i class="fas fa-search"></i>
                        <input type="text" id="doctorSearch" placeholder="Search doctors by name or specialty...">
                    </div>
                </div>
                
                <div class="filter-bar">
                    <div class="filter-group">
                        <label for="specialtyFilter">Specialty:</label>
                        <select id="specialtyFilter">
                            <option value="">All Specialties</option>
                            <option value="cardiology">Cardiology</option>
                            <option value="dermatology">Dermatology</option>
                            <option value="neurology">Neurology</option>
                            <option value="orthopedics">Orthopedics</option>
                            <option value="pediatrics">Pediatrics</option>
                            <option value="psychiatry">Psychiatry</option>
                            <option value="general">General Medicine</option>
                        </select>
                    </div>
                    
                    <div class="filter-group">
                        <label for="experienceFilter">Experience:</label>
                        <select id="experienceFilter">
                            <option value="">Any Experience</option>
                            <option value="5+">5+ Years</option>
                            <option value="10+">10+ Years</option>
                            <option value="15+">15+ Years</option>
                            <option value="20+">20+ Years</option>
                        </select>
                    </div>
                    
                    <div class="filter-group">
                        <label for="ratingFilter">Rating:</label>
                        <select id="ratingFilter">
                            <option value="">Any Rating</option>
                            <option value="4+">4+ Stars</option>
                            <option value="4.5+">4.5+ Stars</option>
                            <option value="4.8+">4.8+ Stars</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Doctors Grid -->
    <section class="doctors-section">
        <div class="container">
            <div class="doctors-grid" id="doctorsGrid">
                <!-- Doctors will be loaded here dynamically -->
            </div>
            
            <div class="loading-spinner" id="loadingSpinner">
                <div class="spinner"></div>
                <p>Loading doctors...</p>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <div class="footer-brand">
                        <i class="fas fa-heartbeat"></i>
                        <span>HealthCare+</span>
                    </div>
                    <p>Modern healthcare management platform connecting patients with qualified medical professionals.</p>
                </div>
                <div class="footer-section">
                    <h3>Quick Links</h3>
                    <ul>
                        <li><a href="doctors.html">Find Doctors</a></li>
                        <li><a href="booking.html">Book Appointment</a></li>
                        <li><a href="register.html">Register</a></li>
                        <li><a href="login.html">Login</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h3>Contact Info</h3>
                    <div class="contact-info">
                        <p><i class="fas fa-phone"></i> +1 (555) 123-4567</p>
                        <p><i class="fas fa-envelope"></i> info@healthcareplus.com</p>
                        <p><i class="fas fa-map-marker-alt"></i> 123 Medical Center Dr.</p>
                    </div>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2024 HealthCare+. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <script src="js/theme-manager.js"></script>
    <script src="js/main.js"></script>
    <script>
        let allDoctors = [];
        let filteredDoctors = [];

        // Initialize doctors page
        document.addEventListener('DOMContentLoaded', function() {
            loadDoctors();
            setupEventListeners();
        });

        function setupEventListeners() {
            // Search functionality
            document.getElementById('doctorSearch').addEventListener('input', filterDoctors);
            document.getElementById('specialtyFilter').addEventListener('change', filterDoctors);
            document.getElementById('experienceFilter').addEventListener('change', filterDoctors);
            document.getElementById('ratingFilter').addEventListener('change', filterDoctors);
        }

        async function loadDoctors() {
            try {
                const response = await fetch('php/doctors.php');
                const doctors = await response.json();
                
                if (doctors.error) {
                    showError('Failed to load doctors: ' + doctors.error);
                    return;
                }
                
                allDoctors = doctors;
                filteredDoctors = doctors;
                displayDoctors(doctors);
                hideLoading();
            } catch (error) {
                console.error('Error loading doctors:', error);
                showError('Failed to load doctors. Please try again later.');
                hideLoading();
            }
        }

        function filterDoctors() {
            const searchTerm = document.getElementById('doctorSearch').value.toLowerCase();
            const specialtyFilter = document.getElementById('specialtyFilter').value;
            const experienceFilter = document.getElementById('experienceFilter').value;
            const ratingFilter = document.getElementById('ratingFilter').value;

            filteredDoctors = allDoctors.filter(doctor => {
                const matchesSearch = doctor.name.toLowerCase().includes(searchTerm) ||
                                    doctor.specialty.toLowerCase().includes(searchTerm);
                
                const matchesSpecialty = !specialtyFilter || doctor.specialty.toLowerCase() === specialtyFilter;
                
                const matchesExperience = !experienceFilter || 
                    (experienceFilter === '5+' && doctor.experience >= 5) ||
                    (experienceFilter === '10+' && doctor.experience >= 10) ||
                    (experienceFilter === '15+' && doctor.experience >= 15) ||
                    (experienceFilter === '20+' && doctor.experience >= 20);
                
                const matchesRating = !ratingFilter ||
                    (ratingFilter === '4+' && doctor.rating >= 4) ||
                    (ratingFilter === '4.5+' && doctor.rating >= 4.5) ||
                    (ratingFilter === '4.8+' && doctor.rating >= 4.8);

                return matchesSearch && matchesSpecialty && matchesExperience && matchesRating;
            });

            displayDoctors(filteredDoctors);
        }

        function displayDoctors(doctors) {
            const grid = document.getElementById('doctorsGrid');
            
            if (doctors.length === 0) {
                grid.innerHTML = `
                    <div class="no-results">
                        <i class="fas fa-search"></i>
                        <h3>No doctors found</h3>
                        <p>Try adjusting your search criteria or filters.</p>
                    </div>
                `;
                return;
            }

            grid.innerHTML = doctors.map(doctor => `
                <div class="doctor-card">
                    <div class="doctor-image">
                        <div class="doctor-avatar">
                            <i class="fas fa-user-md"></i>
                        </div>
                        <div class="doctor-status ${doctor.available ? 'available' : 'busy'}">
                            ${doctor.available ? 'Available' : 'Busy'}
                        </div>
                    </div>
                    
                    <div class="doctor-info">
                        <h3 class="doctor-name">Dr. ${doctor.name}</h3>
                        <p class="doctor-specialty">${doctor.specialty}</p>
                        <p class="doctor-experience">${doctor.experience} years experience</p>
                        
                        <div class="doctor-rating">
                            <div class="stars">
                                ${generateStars(doctor.rating)}
                            </div>
                            <span class="rating-text">${doctor.rating} (${doctor.reviews} reviews)</span>
                        </div>
                        
                        <div class="doctor-details">
                            <p><i class="fas fa-graduation-cap"></i> ${doctor.education}</p>
                            <p><i class="fas fa-map-marker-alt"></i> ${doctor.location}</p>
                            <p><i class="fas fa-dollar-sign"></i> $${doctor.fee} consultation fee</p>
                        </div>
                        
                        <div class="doctor-actions">
                            <button class="btn btn-secondary" onclick="viewProfile(${doctor.id})">
                                View Profile
                            </button>
                            <button class="btn btn-primary" onclick="bookAppointment(${doctor.id})" 
                                    ${!doctor.available ? 'disabled' : ''}>
                                Book Appointment
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function generateStars(rating) {
            const fullStars = Math.floor(rating);
            const halfStar = rating % 1 !== 0;
            const emptyStars = 5 - fullStars - (halfStar ? 1 : 0);
            
            let stars = '';
            for (let i = 0; i < fullStars; i++) {
                stars += '<i class="fas fa-star"></i>';
            }
            if (halfStar) {
                stars += '<i class="fas fa-star-half-alt"></i>';
            }
            for (let i = 0; i < emptyStars; i++) {
                stars += '<i class="far fa-star"></i>';
            }
            
            return stars;
        }

        function viewProfile(doctorId) {
            window.location.href = `profile.html?doctor=${doctorId}`;
        }

        function bookAppointment(doctorId) {
            window.location.href = `booking.html?doctor=${doctorId}`;
        }

        function hideLoading() {
            document.getElementById('loadingSpinner').style.display = 'none';
        }

        function showError(message) {
            const grid = document.getElementById('doctorsGrid');
            grid.innerHTML = `
                <div class="error-state">
                    <i class="fas fa-exclamation-circle"></i>
                    <h3>Error Loading Doctors</h3>
                    <p>${message}</p>
                    <button class="btn btn-primary" onclick="loadDoctors()">Try Again</button>
                </div>
            `;
        }
    </script>
</body>
</html>
